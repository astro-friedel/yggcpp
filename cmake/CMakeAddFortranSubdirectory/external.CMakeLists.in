project(@project_name@_PROJECT)
cmake_minimum_required(VERSION @CMAKE_MINIMUM_REQUIRED_VERSION@)
enable_language(Fortran)
set(CMAKE_Fortran_OUTPUT_EXTENSION @CMAKE_C_OUTPUT_EXTENSION@)
add_library(@project_name@ STATIC @external_sources@)
set_target_properties(
        @project_name@ PROPERTIES
	COMPILE_FLAGS "-cpp -fPIC"
	Fortran_STANDARD 2003
	Fortran_STANDARD_REQUIRED ON
	Fortran_MODULE_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR})
message(STATUS "project_name = @project_name@, ${CMAKE_CURRENT_BINARY_DIR}")
configure_file(
        @CMAKE_CURRENT_FUNCTION_LIST_DIR@/CMakeAddFortranSubdirectory/copy_obj.cmake.in
	${CMAKE_CURRENT_BINARY_DIR}/copy_obj.cmake
	@ONLY)
add_custom_command(
        TARGET @project_name@
	PRE_LINK
	# COMMAND ${CMAKE_COMMAND} -E copy $<TARGET_OBJECTS:@project_name@> ${CMAKE_CURRENT_BINARY_DIR}
	COMMAND ${CMAKE_COMMAND} -E echo "OBJS=$<TARGET_OBJECTS:@project_name@>"
	COMMAND ${CMAKE_COMMAND} -DOBJS=$<TARGET_OBJECTS:@project_name@> -P ${CMAKE_CURRENT_BINARY_DIR}/copy_obj.cmake
	COMMAND_EXPAND_LISTS
)
